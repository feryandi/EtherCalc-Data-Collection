// Generated by LiveScript 1.5.0
(function(){
  this.include = function(){
    return this.client({
      '/player/database.js': function(){
        var $, SocialCalc, header_div;
        $ = window.jQuery || window.$;
        if (!$) {
          return location.reload();
        }
        SocialCalc = window.SocialCalc || alert('Cannot find window.SocialCalc');
        header_div = "<table cellspacing=\"0\" cellpadding=\"0\" style=\"font-weight:bold;margin:8px;\"><tr><td style=\"vertical-align:middle;padding-right:16px;\"><div>Current Label and Data</div></td><td style=\"vertical-align:middle;text-align:right;\"><input type=\"button\" value=\"Scan Spreadsheet\" onclick=\"window.Synchronize();\" style=\"font-size:x-small;\"></td></tr></table>";
        window.DatabaseOnClick = function(s, t){
          var savedData, sheet, loadsheet, sheetdict, gview, pr, dictTxt, table;
          savedData = document.getElementById(spreadsheet.idPrefix + "databaseSavedData");
          sheet = SocialCalc.GetSpreadsheetControlObject();
          loadsheet = new LoadSheet(sheet);
          sheetdict = loadsheet.LoadSheetDict();
          gview = sheet.views.database.element;
          if (savedData.value === null || savedData.value === "") {
            pr = new PredictSheetRows;
            dictTxt = pr.GenerateFromSheetFile(sheetdict);
            gview.innerHTML = header_div;
          } else {
            table = new Table(null, null);
            table.Deserialize(savedData.value);
            gview.innerHTML = header_div + table.GetHTMLForm();
          }
          return;
        };
        window.Save = function(){
          var savedData, payload, request;
          savedData = document.getElementById(spreadsheet.idPrefix + "databaseSavedData");
          console.log("MASUK COY");
          payload = {
            name: SocialCalc._room,
            table: savedData.value
          };
          request = {
            type: "POST",
            url: window.location.protocol + "//" + window.location.host + "/_database/create",
            contentType: "application/json",
            data: JSON.stringify(payload),
            success: function(response){
              return console.log("OK OK OK MYSQL OK OK OK");
            },
            error: function(response){
              return console.log("Error getting predicted data");
            }
          };
          $.ajax(request);
        };
        window.Synchronize = function(){
          var savedData, sheet, loadsheet, sheetdict, pr, featurestxt, payload, request;
          savedData = document.getElementById(spreadsheet.idPrefix + "databaseSavedData");
          sheet = SocialCalc.GetSpreadsheetControlObject();
          loadsheet = new LoadSheet(sheet);
          sheetdict = loadsheet.LoadSheetDict();
          pr = new PredictSheetRows;
          featurestxt = pr.GenerateFromSheetFile(sheetdict);
          payload = {
            features: featurestxt
          };
          request = {
            type: "POST",
            url: window.location.protocol + "//" + window.location.host + "/_framefinder/" + SocialCalc._room,
            contentType: "application/json",
            data: JSON.stringify(payload),
            success: function(response){
              var table, gview;
              table = new Table(sheetdict, response);
              console.log(table.MapHeaderData());
              gview = sheet.views.database.element;
              savedData.value = table.Serialize();
              return gview.innerHTML = header_div + table.GetHTMLForm();
            },
            error: function(response){
              return console.log("Error getting predicted data");
            }
          };
          $.ajax(request);
        };
      }
    });
  };
}).call(this);
